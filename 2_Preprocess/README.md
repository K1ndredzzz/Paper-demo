# 股票评论情绪分析预处理工具

本项目提供了股票评论数据的预处理工具，用于清洗、过滤和分析原始爬取的评论数据，为后续的情绪分析做准备。

## 文件结构

- `preprocess.py`: 主要的预处理脚本
- `test_preprocess.py`: 分析处理后数据的脚本
- `finance_dict.txt`: 金融领域自定义词典，用于提高分词质量

## 环境要求

- Python 3.8+
- pandas
- numpy
- jieba
- matplotlib
- seaborn
- tqdm

可以使用以下命令安装依赖：

```bash
pip install pandas numpy jieba matplotlib seaborn tqdm
```

## 使用方法

### 1. 评论数据预处理

```bash
python preprocess.py --input 原始评论数据.csv --output 处理后的数据.csv
```

参数说明：
- `--input`: 必填，原始评论数据的CSV文件路径
- `--output`: 可选，处理后数据的保存路径，默认为"processed_comments.csv"

### 2. 分析处理后的数据

```bash
python test_preprocess.py --input 处理后的数据.csv
```

参数说明：
- `--input`: 必填，处理后的评论数据CSV文件路径

分析结果将保存在"analysis_results"目录下，包括：
- 评论长度分布图
- 每日评论数量图
- 每小时评论分布图
- 热门股票评论数量图
- 评论关键词权重图
- 热门股票每日评论数变化图

## 数据格式

### 输入数据格式

原始评论数据应该是包含以下列的CSV文件：
- `board_code`: 论坛或板块代码（**保持为字符串格式**）
- `stock_code`: 股票代码（**保持为字符串格式**）
- `date`: 日期
- `time`: 时间
- `source_type`: 来源类型
- `content`: 评论内容

**注意**: 程序自动确保 `stock_code` 和 `board_code` 被处理为字符串格式，避免被错误地转换为数字。这对于以"0"开头的股票代码（如"000001"）尤为重要，以防止前导零被省略。

### 输出数据格式

处理后的数据将包含以下额外的列：
- `clean_comment`: 清洗后的评论内容
- `timestamp`: 合并日期和时间的时间戳
- `hour`: 评论发布小时
- `dayofweek`: 星期几（0=周一，6=周日）
- `tokens`: 分词后的结果（以空格分隔）
- `comment_length`: 评论长度（字符数）
- `token_count`: 分词后的词数

## 预处理步骤说明

1. **数据读取与检查**：读取CSV文件，检查必要的列是否存在，并确保股票代码和板块代码保持为字符串格式
2. **数据清洗**：移除特殊字符、多余空格等
3. **广告过滤**：基于广告关键词过滤广告内容和过短的评论
4. **时间特征提取**：合并日期和时间，提取小时和星期信息
5. **分词处理**：使用jieba进行中文分词，可加载金融领域词典提高质量
6. **统计计算**：计算评论长度、词数等统计信息
7. **结果保存**：将处理后的数据保存为CSV文件

## 注意事项

1. 请确保原始数据的编码为UTF-8，避免中文乱码问题
2. 可以根据实际数据特点，修改广告关键词列表
3. 如果处理大量数据，请确保有足够的内存空间
4. 分词过程可能较慢，耐心等待即可
5. 股票代码（特别是以"0"开头的代码）在整个处理过程中会保持字符串格式，不会被转换为数字 